{% load crispy_forms_tags %}
{% load static %}
{% load embed %}


{% block contenu_page %}

    <div class="card">

        <div class="card-header with-border">
            <h3 class="card-title">{{ data.titre_grille }}</h3>
        </div>

    <div id="in_progress" class="overlay">
        <i class="fa fa-2x fa-refresh fa-spin"></i>
    </div>

    <div class="card-body p-0">

        <div class="commandes_grille d-flex flex-wrap">
            <button type="submit" title="Enregistrer" form="form-maj" class='btn btn-primary btn-sm' value="Sauvegarde"><i class="fa fa-check margin-r-5"></i>Enregistrer</button>
            {% if data.mode == "date" %}
                <a type='button' title="Annuler" class='btn btn-danger btn-sm' href="{% url 'consommations_toc' %}"><i class="fa fa-ban margin-r-5"></i>Annuler</a>
                <button type="button" id="ajouter_individu" class="btn btn-default btn-sm" onclick="$('#modal_ajouter_individu').modal('show');" title="Ajouter un individu"><i class="fa fa-plus margin-r-5"></i>Individu</button>
            {% endif %}
            {% if data.mode == "individu" %}
                <a type='button' title="Annuler" class='btn btn-danger btn-sm' href="{% url 'famille_resume' idfamille=idfamille %}"><i class="fa fa-ban margin-r-5"></i>Annuler</a>
                <button type="button" id="traitement_par_lot" class="btn btn-default btn-sm" onclick="$('#modal_traitement_lot').modal('show');" title="Traitement par lot"><i class="fa fa-magic margin-r-5"></i>Traitement par lot</button>
            {% endif %}
            {% if data.mode == "individu" %}
                <button type="button" id="pdf" class="btn btn-default btn-sm" onclick="impression_pdf()" title="Aperçu PDF"><i class="fa fa-file-pdf-o margin-r-5"></i>Imprimer</button>
                <button type="button" id="email" class="btn btn-default btn-sm" onclick="impression_pdf(true)" title="Envoyer par email"><i class="fa fa-send-o margin-r-5"></i>Email</button>
            {% endif %}
            <button type="button" id="saisie_pointage" class="btn btn-default btn-sm" onclick="$('#modal_saisir_pointage').modal('show');" title="Pointage par lot"><i class="fa fa-check-square-o margin-r-5"></i>Pointage</button>
            <button type="button" id="tout_recalculer" class="btn btn-default btn-sm mr-auto" onclick="tout_recalculer()" title="Tout recalculer"><i class="fa fa-refresh margin-r-5"></i>Recalculer</button>

            <div>
                <div class="input-group input-group-sm " style="width: 140px;">
                    <div class="input-group-prepend">
                        <button type="submit" class="input-group-text"><i class="fa fa-search"></i></button>
                    </div>
                    <input type="text" id="rechercher" class="form-control form-control-sm text-sm" title="Rechercher une date ou un individu" placeholder="Rechercher...">
                </div>
            </div>

            <div>
                <div class="input-group input-group-sm" style="width: 140px;">
                    <div class="input-group-prepend">
                        <button type="submit" class="input-group-text"><i class="fa fa-pencil"></i></button>
                    </div>
                    <select class="select form-control form-control-sm text-sm" id="mode_saisie" title="Sélection du mode de saisie">
                        <option value="reservation">Réservation</option>
                        <option value="attente">Attente</option>
                        <option value="refus">Refus</option>
                    </select>
                </div>
            </div>

        </div>

        {% include "consommations/grille_tableau.html" %}

    </div>

    {# Importation des modals #}
    {% include 'consommations/grille_saisie_horaires.html' %}
    {% include 'consommations/grille_saisie_quantite.html' %}
    {% include 'consommations/grille_saisie_memo.html' %}
    {% include 'consommations/grille_saisie_pointage.html' %}
    {% if data.mode == "individu" %}
        {% include 'consommations/grille_traitement_lot.html' %}
        {% include 'core/modal_pdf.html' %}
    {% endif %}

    {# Menu contextuel des consommations #}
    <div id="contextMenu" class="dropdown clearfix">
        <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu" style="display:block;position:static;margin-bottom:5px;">
            <li class="dropdown-item"><a tabindex="-1" href="#" id="contextmenu_supprimer">Supprimer</a></li>
            <li class="dropdown-divider"></li>
            <li class="dropdown-item"><a tabindex="-1" href="#" data-etat="reservation" id="contextmenu_reservation">Réservation</a></li>
            <li class="dropdown-item"><a tabindex="-1" href="#" data-etat="attente" id="contextmenu_attente">Attente</a></li>
            <li class="dropdown-item"><a tabindex="-1" href="#" data-etat="refus" id="contextmenu_refus">Refus</a></li>
            <li class="dropdown-divider"></li>
            <li class="dropdown-item"><a tabindex="-1" href="#" data-etat="present" id="contextmenu_present">Présent</a></li>
            <li class="dropdown-item"><a tabindex="-1" href="#" data-etat="absentj" id="contextmenu_absentj">Absence justifiée</a></li>
            <li class="dropdown-item"><a tabindex="-1" href="#" data-etat="absenti" id="contextmenu_absenti">Absence injustifiée</a></li>
            <li class="dropdown-divider"></li>
        </ul>
    </div>


{% endblock contenu_page %}






